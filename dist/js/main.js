// Generated by CoffeeScript 1.9.0
(function() {
  var closeSideMenu, hideAllChildrenOf, openSideMenu, showAllParentsOf, showSubMenuItems;

  $(function() {

    /*
      HASH FUNCTIONALITY IS FOR TESTING ONLY
      REMOVE FOR ANY PRODUCTION USE
     */
    var subMenuToActivate, submenu, submenus, _i, _len, _results;
    if (window.location.hash) {
      $("body").addClass(window.location.hash.substr(1));
    }
    $(".menu__open-side-menu").on("click", function() {
      return openSideMenu();
    });
    $(".scaffold__menu-close-btn").on("click", function() {
      return closeSideMenu();
    });
    $("[class*='left-menu__item']").on("click", function() {
      return showSubMenuItems($(this));
    });
    submenus = [];
    $("*[data-role='has_submenu']").each(function() {
      return submenus.push($(this).data('children'));
    });
    _results = [];
    for (_i = 0, _len = submenus.length; _i < _len; _i++) {
      submenu = submenus[_i];
      if ($("body").hasClass(submenu)) {
        subMenuToActivate = $('*[data-children="' + submenu + '"]');
        showSubMenuItems(subMenuToActivate);
        if (subMenuToActivate.data('parent')) {
          _results.push(showAllParentsOf(subMenuToActivate));
        } else {
          _results.push(void 0);
        }
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  });

  showSubMenuItems = function(subMenu) {
    var child_element_val, child_state, data_url, new_child_state;
    if (subMenu.data('role') === 'has_submenu') {
      child_state = subMenu.data('child_state');
      new_child_state = 'visible';
      if (child_state != null) {
        if (child_state === 'visible') {
          new_child_state = 'hidden';
        } else {
          new_child_state = 'visible';
        }
      }
      child_element_val = subMenu.data('children');
      $("*[data-parent='" + child_element_val + "']").each(function() {
        if (new_child_state === 'hidden') {
          $(this).slideUp();
          if ($(this).data('children')) {
            return hideAllChildrenOf($(this).data('children'));
          }
        } else if (new_child_state === 'visible') {
          $(this).slideDown();
          return $(this).show();
        }
      });
      return subMenu.data('child_state', new_child_state);
    } else {
      data_url = subMenu.data('url');
      if (data_url) {
        return window.location = data_url;
      }
    }
  };

  openSideMenu = function() {
    $(".scaffold__menu").addClass("scaffold__menu--open");
    $(".scaffold__content").addClass("scaffold__content--open");
    $(".scaffold").append("<div class='scaffold__modal'></div>");
    $(".scaffold__modal").addClass("scaffold__modal--open");
    return $(".scaffold__modal").on("click", function() {
      return closeSideMenu();
    });
  };

  closeSideMenu = function() {
    $(".scaffold__menu").removeClass("scaffold__menu--open");
    $(".scaffold__content").removeClass("scaffold__content--open");
    return $(".scaffold__modal").remove();
  };


  /*
    Recursive methods for hiding and showing submenu items
   */

  hideAllChildrenOf = function(val) {
    $("*[data-parent='" + val + "']").each(function() {
      $(this).slideUp();
      if ($(this).data('children')) {
        return hideAllChildrenOf($(this).data('children'));
      }
    });
    return $("*[data-children='" + val + "']").data('child_state', 'hidden');
  };

  showAllParentsOf = function(subMenu) {
    var parentID, parentMenuItem;
    parentID = subMenu.data('parent');
    parentMenuItem = $("*[data-children='" + parentID + "']");
    showSubMenuItems(parentMenuItem);
    if (parentMenuItem.data('parent')) {
      return showAllParentsOf(parentMenuItem);
    }
  };

}).call(this);
